module Project6(ibus,clk,abus,bbus,dbus);

output [31:0] abus,bbus,dbus;
input [31:0] ibus;
input clk;

wire [31:0] Aselect,Bselect,Dselect;
wire [2:0] S;
wire Imm,Cin;

wire [31:0] bus,rs,rt,rd,dsel,signex32,sign2ex32;
wire I,Cin1;
wire [2:0] Sel;

wire [31:0] a1bus,b1bus,d1bus,a2bus,b2bus,d2bus,bbusout;
wire Cout,V;

DFF32 IF(ibus,clk,bus);

Decoder rs_decode(bus[25:21],rs);
Decoder rt_decode(bus[20:16],rt);
Decoder rd_decode(bus[15:11],rd);
Opcode op_decode(bus,I,Sel,Cin1);

Mux21 MuxDSel(rd,rt,I,dsel);

SignEx SExt(bus[15:0], signex32);

//assign Aselect = rs;
//assign Bselect = rt;

RegisterFile register(rs,rt,dsel,clk,a1bus,b1bus,d1bus);

DFF32 DFFABus(a1bus,clk,abus);
DFF32 DFFBBus(b1bus,clk,b2bus);
DFF32 DFFSignEx(signex32,clk,sign2ex32);


DFF3 SOut(Sel,clk,S);
DFF ImmOut(I,clk,Imm);
DFF CinOut(Cin1,clk,Cin);

Mux21 MuxBBus(b2bus,sign2ex32,Imm,bbus);


ALU ALU0(abus,bbus,d2bus,S,V,Cin,Cout);


DFF32 dFF(d2bus,clk,dbus);


assign d1bus = dbus;

endmodule
